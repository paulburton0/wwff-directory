extends layout
block content
    .container
        h1= title

        input(type="search" name="search" id="search")
        table.table.table-striped
            thead.thead-default
                tr
                    th Ref
                    th Status
                    th Name
                    th DXCC
                    th Region
                    th Notes

            tbody(id="update")
                //- for(i=1; i<docs.length; i++){
                    //tr
                        //- if(docs[i].Status == 'deleted'){
                            //td.deleted.ref #{docs[i].Ref}
                            //td.deleted #{docs[i].Status}
                            //td.deleted #{docs[i].Name}
                            //td.deleted #{docs[i].DXCC}
                            //td.deleted #{docs[i].Region}
                            //td.deleted #{docs[i].Notes}
                        //- } else {
                            //td.ref #{docs[i].Ref}
                            //td #{docs[i].Status}
                            //td #{docs[i].Name}
                            //td #{docs[i].DXCC}
                            //td #{docs[i].Region}
                            //td #{docs[i].Notes}
                        //- }
                //- }
    script.
        var searchString;
        $('#search').keyup(function(){
            var searchString = $('#search').val()
            var myExp = new RegExp(searchString, 'i');
            $.getJSON(!{JSON.stringify(docs)}, function(data){
                var output;
                $.each(data, function(key, val){
                    if((val.Ref.search(myExp) != -1) || (val.Name.search(myExp) != -1) || (val.DXCC.search(myExp) != -1) || (val.Region.search(myExp) != -1) || (val.Notes.search(myExp) != -1)) {
                        output += '<tr>';
                        output += '<td>' + val.Ref + '</td>';
                        output += '<td>' + val.Status + '</td>';
                        output += '<td>' + val.Name + '</td>';
                        output += '<td>' + val.DXCC + '</td>';
                        output += '<td>' + val.Region + '</td>';
                        output += '<td>' + val.Notes + '</td>';
                        output += '</tr>';
                    }
                });
                $('#update').html(output);
            });
        });
